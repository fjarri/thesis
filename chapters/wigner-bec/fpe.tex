% =============================================================================
\section{Fokker-Planck equation}
% =============================================================================

The general approach to numerical solution of the Fokker-Planck equation~\eqnref{wigner-bec:truncation:fpe} is to transform it to the equivalent set of stochastic differential equations (SDEs) for $\Psi_j$.
Since the transformation is defined for real-valued variables only \todo{citation needed}, we have to modify the equation.

First, noticing that $K_{jk}$, $U_{jk}$ and $\kappa_{\lvec}$ are real-valued (which is important for the further transformations), we can rewrite equation~\eqnref{wigner-bec:truncation:fpe} as
\begin{eqn}
	\frac{dW}{dt}
	= \int d\xvec \left(
		- \sum_{j=1}^C \frac{\delta}{\delta \Psi_j} A_j
		- \sum_{j=1}^C \frac{\delta}{\delta \Psi_j^*} A_j^*
		+ \sum_{j=1}^C \sum_{k=1}^C \frac{\delta^2}{\delta \Psi_j^* \delta \Psi_k} D_{jk}
	\right) W,
\end{eqn}
where
\begin{eqn}
	A_j = -\frac{i}{\hbar} \left(
			\sum_{k=1}^C K_{jk} \Psi_k
			+ \sum_{k=1}^C U_{jk} \Psi_j \Psi_k \Psi_k^*
		\right)
		- \sum_{\lvec} \kappa_{\lvec} \frac{\partial O_{\lvec}^*}{\partial \Psi_j^*} O_{\lvec},
\end{eqn}
and
\begin{eqn}
	D_{jk} = \sum_{\lvec} \kappa_{\lvec}
		\frac{\partial O_{\lvec}}{\partial \Psi_j}
		\frac{\partial O_{\lvec}^*}{\partial \Psi_k^*}.
\end{eqn}
Considering $\Psi_j = \sum_{\nvec \in \restbasis_j} \phi_{j,\nvec} \alpha_{j,\nvec}$ and replacing functional derivatives with ordinary ones:
\begin{eqn}
	\frac{dW}{dt}
	={} & \left(
		- \sum_{j=1}^C \sum_{\nvec \in L}
			\frac{\partial}{\partial \alpha_{j,\nvec}}
			\int d\xvec \phi_{j,\nvec}^* A_j
		- \sum_{j=1}^C \sum_{\nvec \in L}
			\frac{\partial}{\partial \alpha_{j,\nvec}^*}
			\int d\xvec \phi_{j,\nvec} A_j^* \right. \\
	&	\left. + \sum_{j=1}^C \sum_{k=1}^C
			\sum_{\mvec \in \restbasis_j,\nvec \in \restbasis_k}
			\frac{\partial}{\partial \alpha_{j,\mvec}^*}
			\frac{\partial}{\partial \alpha_{k,\nvec}}
			\int d\xvec
			\phi_{j,\mvec} \phi_{k,\nvec}^* D_{jk}
	\right) W.
\end{eqn}

\begin{lemma}[FPE--SDEs correspondence in convenient form.]
\label{lmm:wigner-bec:fpe:fpe-sde-real}
	If $\zvec^T \equiv (z_1 \ldots z_M)$ is a set of real-valued variables, Fokker-Planck equation
	\begin{eqn*}
		\frac{dW}{dt}
		= -\bpartial_{\zvec}^T \avec W
		+ \frac{1}{2} \Trace{ \bpartial_{\zvec} \bpartial_{\zvec}^T B B^T } W
	\end{eqn*}
	is equivalent to a set of stochastic differential equations in It\^{o} form
	\begin{eqn*}
		d\zvec = \avec dt + B d\Zvec
	\end{eqn*}
	and to a set of stochastic differential equations in Stratonovich form
	\begin{eqn*}
		d\zvec = (\avec - \svec)dt + B d\Zvec,
	\end{eqn*}
	where the noise-induced (or spurious) drift vector $\svec$ has elements
	\begin{eqn*}
		s_i
		= \sum_{k,j} B_{kj} \frac{\partial}{\partial z_k} B_{ij}
		= \Trace{B^T \bpartial_z \evec_i^T B},
	\end{eqn*}
	$\evec_i$ being the unit vector with elements $(\evec_i)_j = \delta_{ij}$.
	\todo{Is there a better way to express $\svec$ in terms of matrices?}
	Here $W \equiv W(\zvec)$ is a probability distribution, $\avec \equiv \avec(\zvec)$ is a vector function, $B \equiv B(\zvec)$ is a matrix function ($B$ having size $M \times L$, where $L$ corresponds to the number of noise sources), $\bpartial_{\zvec}^T \equiv (\partial_{z_1} \ldots \partial_{z_M})$ is a vector differential, and $d\Zvec$ is a standard $L$-dimensional Wiener process.
\end{lemma}
\begin{proof}
For details see~\cite{Risken1996}, sections 3.3 and 3.4.
\todo{Consider the case of colored noise (\cite{Risken1996}, 3.1 and appendix A).}
\end{proof}

\begin{theorem}
\label{thm:wigner-bec:fpe:fpe-sde-complex}
	If $\balpha^T \equiv (\alpha_1 \ldots \alpha_M)$ is a set of complex-valued variables,
	Fokker-Planck equation
	\begin{eqn*}
		\frac{dW}{dt}
		= -\bpartial_{\balpha}^T \avec W - \bpartial_{\balpha^*}^T \avec^* W
		+ \Trace{ \bpartial_{\balpha} \bpartial_{\balpha^*}^T B B^H } W
	\end{eqn*}
	is equivalent to a set of stochastic differential equations in It\^{o} form
	\begin{eqn*}
		d\balpha = \avec dt + B d\Zvec,
	\end{eqn*}
	or to Stratonovich form
	\begin{eqn*}
		d\balpha = (\avec - \svec) dt + B d\Zvec,
	\end{eqn*}
	where noise-induced drift term is
	\begin{eqn*}
		s_j = \Trace{ B^H \bpartial_{\balpha^*} \evec_j^T B },
	\end{eqn*}
	and $d\Zvec = (d\bm{X} + id\bm{Y}) / \sqrt{2}$ is an $M$-dimensional complex-valued Wiener process,
	containing two standard $M$-dimensional Wiener processes $d\bm{X}$ and $d\bm{Y}$.
\end{theorem}
\begin{proof}
Let us expand the FPE using real values $\balpha = \bm{x} + i \bm{y}$, $\avec = \bm{u} + i \bm{v}$, $B = G + iF$, $\bpartial_{\balpha} = (\bpartial_{\bm{x}} - i \bpartial_{\bm{y}}) / 2$.
Thus
\begin{eqn}
	\frac{dW}{dt}
	={} & - \bpartial_{\bm{x}}^T \bm{u} W
	- \bpartial_{\bm{y}}^T \bm{v} W
	+ \frac{1}{4} \Trace{
		(\bpartial_{\bm{x}} \bpartial_{\bm{x}}^T
			+ \bpartial_{\bm{y}} \bpartial_{\bm{y}}^T)
		(F F^T + G G^T) \right. \\
	& \left. + (\bpartial_{\bm{x}} \bpartial_{\bm{y}}^T
			- \bpartial_{\bm{y}} \bpartial_{\bm{x}}^T)
		(F G^T - G F^T)
	} W \\
	& - \frac{i}{4} \Trace{
		(\bpartial_{\bm{x}} \bpartial_{\bm{x}}^T
			+ \bpartial_{\bm{y}} \bpartial_{\bm{y}}^T)
		(F G^T - G F^T)
	} W \\
	& + \frac{i}{4} \Trace{
		(\bpartial_{\bm{x}} \bpartial_{\bm{y}}^T
			- \bpartial_{\bm{y}} \bpartial_{\bm{x}}^T)
		(F F^T + G G^T)
	} W.
\end{eqn}
Since $F F^T + G G^T$ and $\bpartial_{\bm{x}} \bpartial_{\bm{x}}^T + \bpartial_{\bm{y}} \bpartial_{\bm{y}}^T$ are symmetric matrices, and $F G^T - G F^T$ and $\bpartial_{\bm{x}} \bpartial_{\bm{y}}^T - \bpartial_{\bm{y}} \bpartial_{\bm{x}}^T$ are antisymmetric, corresponding traces are equal to zero, which gives us FPE in real variables
\begin{eqn}
	\frac{dW}{dt}
	={} & - \bpartial_{\bm{x}}^T \bm{u} W
	- \bpartial_{\bm{y}}^T \bm{v} W
	+ \frac{1}{4} \Trace{
		(\bpartial_{\bm{x}} \bpartial_{\bm{x}}^T
			+ \bpartial_{\bm{y}} \bpartial_{\bm{y}}^T)
		(F F^T + G G^T) \right. \\
	& \left. + (\bpartial_{\bm{x}} \bpartial_{\bm{y}}^T
			- \bpartial_{\bm{y}} \bpartial_{\bm{x}}^T)
		(F G^T - G F^T)
	} W.
\end{eqn}

In order to use \lmmref{wigner-bec:fpe:fpe-sde-real},
we need to join variables $\bm{x}$ and $\bm{y}$ into the one variable vector $\zvec^T \equiv \bm{x}^T \oplus \bm{y}^T$.
This will give us an equation identical to one from the lemma, with $\avec^T \equiv \bm{u}^T \oplus \bm{v}^T$ and diffusion matrix
\begin{eqn}
	B B^T \equiv \frac{1}{2} \begin{pmatrix}
		F F^T + G G^T & F G^T - G F^T \\
		G F^T - F G^T & F F^T + G G^T
	\end{pmatrix},
\end{eqn}
which gives a noise matrix
\begin{eqn}
	B = \frac{1}{\sqrt{2}} \begin{pmatrix}
		F & -G \\
		G & F
	\end{pmatrix}.
\end{eqn}
Therefore the equivalent SDEs in It\^{o} form are
\begin{eqn}
	d\zvec = \avec dt + B d\Zvec,
\end{eqn}
where $d\Zvec^T \equiv d\bm{X}^T \oplus d\bm{Y}^T$.
Returning to our previous variables:
\begin{eqn}
	d\bm{x} & = \bm{u} dt + \frac{1}{\sqrt{2}} F d\bm{X} - \frac{1}{\sqrt{2}} G d\bm{Y} \\
	d\bm{y} & = \bm{v} dt + \frac{1}{\sqrt{2}} G d\bm{X} + \frac{1}{\sqrt{2}} F d\bm{Y}.
\end{eqn}
Multiplying the second equation by $i$ and adding it to the first one:
\begin{eqn}
	d\balpha = \avec dt + \frac{1}{\sqrt{2}} (F + iG) (d\bm{X} + id\bm{Y}),
\end{eqn}
which leads to the It\^{o} part of the lemma statement.
\begin{eqn}
	d\balpha = \avec dt + B d\Zvec.
\end{eqn}

Noise-induced drift term in Stratonovich case can be calculated as
\begin{eqn}
	s_j^{(x)}
	& = \frac{1}{2} \Trace{
		\begin{pmatrix}
			F^T & G^T \\ -G^T & F^T
		\end{pmatrix}
		\begin{pmatrix}
			\bpartial_{\bm{x}} \\
			\bpartial_{\bm{y}}
		\end{pmatrix}
		\begin{pmatrix}
			\evec_j^T & 0
		\end{pmatrix}
		\begin{pmatrix}
			F & -G \\ G & F
		\end{pmatrix}
	} \\
	& = \frac{1}{2} \Trace{
		\begin{pmatrix}
			F^T & G^T \\ -G^T & F^T
		\end{pmatrix}
		\begin{pmatrix}
			\bpartial_{\bm{x}} \\
			\bpartial_{\bm{y}}
		\end{pmatrix}
		\begin{pmatrix}
			\evec_j^T F & - \evec_j^T G
		\end{pmatrix}
	} \\
	& = \frac{1}{2} \Trace{
		\begin{pmatrix}
			F^T & G^T \\ -G^T & F^T
		\end{pmatrix}
		\begin{pmatrix}
			\bpartial_{\bm{x}} \evec_j^T F & - \bpartial_{\bm{x}} \evec_j^T G \\
			\bpartial_{\bm{y}} \evec_j^T F & - \bpartial_{\bm{y}} \evec_j^T G
		\end{pmatrix}
	} \\
	& = \frac{1}{2} \left(
		\Trace{ F^T \bpartial_{\bm{x}} \evec_j^T F }
		+ \Trace{ G^T \bpartial_{\bm{y}} \evec_j^T F }
		+ \Trace{ G^T \bpartial_{\bm{x}} \evec_j^T G }
		- \Trace{ F^T \bpartial_{\bm{y}} \evec_j^T G }
	\right).
\end{eqn}
Similarly,
\begin{eqn}
	s_j^{(y)}
	= \frac{1}{2} \left(
		\Trace{ F^T \bpartial_{\bm{x}} \evec_j^T G }
		+ \Trace{ G^T \bpartial_{\bm{y}} \evec_j^T G }
		- \Trace{ G^T \bpartial_{\bm{x}} \evec_j^T F }
		+ \Trace{ F^T \bpartial_{\bm{y}} \evec_j^T F }
	\right).
\end{eqn}
Therefore the final term in complex-valued SDEs is
\begin{eqn}
	s_j
	= s_j^{(x)} + i s_j^{(y)}
	= \Trace{ B^H \bpartial_{\balpha^*} \evec_j^T B }.
	\qedhere
\end{eqn}
\end{proof}

\begin{theorem}[Multi-component extension of \thmref{wigner-bec:fpe:fpe-sde-complex}]
\label{thm:wigner-bec:fpe:mc-fpe-sde}
If $\balpha^{(c)},\, c = 1..C$ are $C$ sets of complex variables $\balpha^{(c)} \equiv (\alpha_1^{(c)} \ldots \alpha_M^{(c)})$,
then Fokker-Planck equation
\[
	\frac{dW}{dt}
	= - \sum_{c=1}^C \bpartial_{\balpha^{(c)}}^T \avec^{(c)} W
	- \sum_{c=1}^C \bpartial_{(\balpha^{(c)})^*}^T (\avec^{(c)})^* W
	+ \sum_{m=1}^c \sum_{n=1}^c
		\Trace{
			\bpartial_{\balpha^{(m)}}
			\bpartial_{(\balpha^{(n)})^*}^T
			B^{(n)} (B^{(m)})^H
		} W
\]
is equivalent to a set of stochastic differential equations in It\^{o} form
\[
	d\balpha^{(c)} = \avec^{(c)} dt + B^{(c)} d\Zvec,\, c = 1..C
\]
or to Stratonovich form
\[
	d\balpha^{(c)} = (\avec^{(c)} - \bm{c}^{(c)}) dt + B^{(c)} d\Zvec,
\]
where noise-induced drift term is
\[
	c_j^{(c)} = \sum_{n=1}^C
		\Trace{ (B^{(n)})^H \bpartial_{(\balpha^{(n)})^*} \evec_j^T B^{(c)} },
\]
and $d\Zvec$ is an $L$-dimensional complex-valued Wiener process.
\end{theorem}
\begin{proof}
Let us join all variable sets $\balpha^{(c)}$ into one set $\balpha^T \equiv ((\balpha^{(1)})^T \ldots (\balpha^{(C)})^T)$.
Then we can use \thmref{wigner-bec:fpe:fpe-sde-complex} with drift vector
\[
	\avec = \begin{pmatrix}
		\avec^{(1)} \\ \vdots \\ \avec^{(C)}
	\end{pmatrix},
\]
differentials vector
\[
	\bpartial_{\balpha} = \begin{pmatrix}
		\bpartial_{\balpha^{(1)}} \\ \vdots \\ \bpartial_{\balpha^{(C)}}
	\end{pmatrix},
\]
and noise matrix
\[
	B = \begin{pmatrix}
		B^{(1)} \\ \vdots \\ B^{(C)}
	\end{pmatrix}.
\]
This gives us SDEs in It\^{o} form
\[
	d\balpha = \avec dt + B d\Zvec,
\]
where $\Zvec$ is an $L$-dimensional complex-valued Wiener process.
Splitting this equation for different components, we get the statement of the lemma.
Stratonovich variant is obtained in the same way.
Noise-induced drift term requires some work:
\begin{equation*}
\begin{split}
	c_j^{(c)}
	& = \Trace{
		\begin{pmatrix} (B^{(1)})^H & \cdots & (B^{(C)})^H \end{pmatrix}
		\begin{pmatrix}
			\bpartial_{(\balpha^{(1)})^*} \\
			\vdots \\
			\bpartial_{(\balpha^{(C)})^*}
		\end{pmatrix}
		\begin{pmatrix} 0 & \cdots & \evec_j^T & \cdots & 0 \end{pmatrix}
		\begin{pmatrix}
			B^{(1)} \\
			\vdots \\
			B^{(C)}
		\end{pmatrix}
	} \\
	& = \Trace{
		\begin{pmatrix} (B^{(1)})^H & \cdots & (B^{(C)})^H \end{pmatrix}
		\begin{pmatrix}
			\bpartial_{(\balpha^{(1)})^*} \evec_j^T B^{(c)} \\
			\vdots \\
			\bpartial_{(\balpha^{(C)})^*} \evec_j^T B^{(c)}
		\end{pmatrix}
	} \\
	& = \sum_{n=1}^C \Trace{
		(B^{(n)})^H
		\bpartial_{(\balpha^{(n)})^*}
		\evec_j^T
		B^{(c)}
	}.
\end{split}
\end{equation*}
\end{proof}

\begin{theorem}
Functional FPE
\[
	\frac{dW}{dt}
	= \int d\xvec \left(
		- \sum_{j=1}^C \frac{\delta}{\delta \Psi_j} A_j
		- \sum_{j=1}^C \frac{\delta}{\delta \Psi_j^*} A_j^*
		+ \sum_{j=1}^C \sum_{k=1}^C \frac{\delta^2}{\delta \Psi_j \delta \Psi_k^*}
			\sum_{\lvec} B_{\lvec}^{(k)} (B_{\lvec}^{(j)})^*
	\right) W
\]
is equivalent to the set of SDEs in It\^{o} form
\[
	d\Psi_j = \mathcal{P} \left[
		A^{(j)} dt + \sum_{\lvec} B_{\lvec}^{(j)} d\bm{Q}_{\lvec}
	\right],
\]
or in Stratonovich form
\[
	d\Psi_j = \mathcal{P} \left[
		(A^{(j)} - C^{(j)}) dt + \sum_{\lvec} B_{\lvec}^{(j)} d\bm{Q}_{\lvec}
	\right],
\]
where
\[
	C^{(j)} = \sum_{n=1}^C \sum_{\lvec}
		(B_{\lvec}^{(n)})^*
		\frac{\delta}{\delta \Psi_n^*}
		B_{\lvec}^{(j)},
\]
and $\bm{Q}_{\lvec}$ is a functional Wiener process:
\[
	\bm{Q}_{\lvec} = \sum_{\nvec \in L \cup H} \phi_j \Zvec_{\lvec,\nvec}.
\]
\end{theorem}
\begin{proof}
Considering $\Psi_j = \sum_{\nvec \in L} \phi_{\nvec} \alpha_{j,\nvec}$ and replacing functional derivatives with ordinary ones:
\begin{equation*}
\begin{split}
	\frac{dW}{dt}
	& = \left(
		- \sum_{j=1}^C \sum_{\nvec \in L}
			\frac{\partial}{\partial \alpha_{j,\nvec}}
			\int d\xvec \phi_{\nvec}^* A_j
		- \sum_{j=1}^C \sum_{\nvec \in L}
			\frac{\partial}{\partial \alpha_{j,\nvec}^*}
			\int d\xvec \phi_{\nvec} A_j^*
		\right. \\
	&	\left. + \sum_{j=1}^C \sum_{k=1}^C
			\sum_{\mvec,\nvec \in L}
			\frac{\partial}{\partial \alpha_{j,\mvec}}
			\frac{\partial}{\partial \alpha_{k,\nvec}^*}
			\int d\xvec
			\phi_{\nvec} \phi_{\mvec}^*
			\sum_{\lvec} B_{\lvec}^{(k)} (B_{\lvec}^{(j)})^*
	\right) W.
\end{split}
\end{equation*}
The diffusion term has to be transformed in order to conform to \thmref{wigner-bec:fpe:mc-fpe-sde}:
\begin{equation*}
\begin{split}
	\int d\xvec \phi_{\nvec} \phi_{\mvec}^* \sum_{\lvec} B_{\lvec}^{(k)} (B_{\lvec}^{(j)})^*
	& = \int d\xvec \int d\xvec^\prime
			\phi_{\nvec}^\prime \phi_{\mvec}^*
			\sum_{\lvec} B_{\lvec}^{(k)} (B_{\lvec}^{(j)})^{\prime*}
			\delta(\xvec - \xvec^\prime) \\
	& = \int d\xvec \int d\xvec^\prime
			\phi_{\nvec}^\prime \phi_{\mvec}^*
			\sum_{\lvec} B_{\lvec}^{(k)} (B_{\lvec}^{(j)})^{\prime*}
			\sum_{\pvec \in L \cup H} \phi_{\pvec}^{\prime*} \phi_{\pvec} \\
	& = \sum_{\pvec \in L \cup H, \lvec}
		\int d\xvec
			\phi_{\nvec}^* B_{\lvec}^{(k)} \phi_{\pvec}
		\int d\xvec
			\phi_{\mvec} (B_{\lvec}^{(j)})^* \phi_{\pvec}^*
\end{split}
\end{equation*}
Now we have the FPE from \thmref{wigner-bec:fpe:mc-fpe-sde} with
\[
	\avec_{\mvec}^{(c)} = \int d\xvec \phi_{\mvec}^* A_c,\,\mvec \in L
\]
and
\[
	B_{\mvec,(\nvec,\lvec)}^{(c)} = \int d\xvec \phi_{\mvec}^* B_{\lvec}^{(c)} \phi_{\nvec},\,
	\mvec \in L, \nvec \in L \cup H.
\]
Note that columns of $B$ are enumerated using compound index $\nvec,\lvec$.

Therefore the initial FPE is equivalent to the set of SDEs in It\^{o} form
\[
	d\alpha_{\mvec}^{(c)}
	= \int d\xvec \phi_{\mvec}^* A_c dt
	+ \sum_{\nvec \in L \cup H, \lvec}
		\int d\xvec \phi_{\mvec}^* B_{\lvec}^{(c)} \phi_{\nvec} d\Zvec_{\nvec,\lvec}.
\]
Multiplying by $\phi_{\mvec}^\prime$ and grouping by component:
\[
	\sum_{\mvec} \phi_{\mvec}^\prime d\alpha_{\mvec}^{(c)}
	= \sum_{\mvec} \phi_{\mvec}^\prime \int d\xvec \phi_{\mvec}^* A_c dt
	+ \sum_{\mvec} \phi_{\mvec}^\prime \int d\xvec \phi_{\mvec}^*
		\sum_{\nvec \in L \cup H, \lvec} B_{\lvec}^{(c)} \phi_{\nvec} d\Zvec_{\nvec,\lvec}.
\]
Recognising \defref{func-calculus:projector} of projection transformation:
\[
	d\Psi_c
	= \mathcal{P} \left[
		A_c dt
		+ \sum_{\lvec} B_{\lvec}^{(c)}
			\sum_{\nvec \in L \cup H} \phi_{\nvec} d\Zvec_{\nvec,\lvec}
	\right].
\]
Defining functional Wiener process $\bm{Q}_{\lvec} = \sum_{\nvec \in L \cup H} \phi_{\nvec} d\Zvec_{\nvec,\lvec}$:
\[
	d\Psi_c
	= \mathcal{P} \left[
		A_c dt
		+ \sum_{\lvec} B_{\lvec}^{(c)} d\bm{Q}_{\lvec}
	\right].
\]

Performing the same multiplication and addition on Stratonovich term from \thmref{wigner-bec:fpe:mc-fpe-sde}:
\begin{equation*}
\begin{split}
	C_c
	& = \sum_{\mvec \in L} \phi_{\mvec}^\prime c_{\mvec}^{(c)} \\
	& = \sum_{\mvec \in L} \phi_{\mvec}^\prime \sum_{n=1}^C \Trace{
		(B^{(n)})^H \bpartial_{(\balpha^{(n)})^*} \evec_j^T B^{(c)}
	} \\
	& = \sum_{\mvec \in L} \phi_{\mvec}^\prime \sum_{n=1}^C
		\sum_{\jvec \in L} \sum_{\kvec \in L \cup H} \sum_{\lvec}
		\int d\xvec \phi_{\jvec} (B_{\lvec}^{(n)})^* \phi_{\kvec}^*
		\int d\xvec \phi_{\mvec}
			\frac{\partial}{\partial (\alpha_{\jvec}^{(n)})^*} B_{\lvec}^{(c)} \phi_{\kvec} \\
	& = \mathcal{P} \left[
		\sum_{n=1}^C
		\sum_{\jvec \in L} \sum_{\kvec \in L \cup H} \sum_{\lvec}
		\int d\xvec \phi_{\jvec} (B_{\lvec}^{(n)})^* \phi_{\kvec}^*
		\frac{\partial}{\partial (\alpha_{\jvec}^{(n)})^*} (B_{\lvec}^{(c)})^\prime \phi_{\kvec}^\prime
	\right] \\
	& = \mathcal{P} \left[
		\sum_{n=1}^C
		\sum_{\jvec \in L} \sum_{\lvec}
		\int d\xvec \phi_{\jvec} (B_{\lvec}^{(n)})^* \delta(\xvec - \xvec^\prime)
		\frac{\partial}{\partial (\alpha_{\jvec}^{(n)})^*} (B_{\lvec}^{(c)})^\prime
	\right] \\
	& = \mathcal{P} \left[
		\sum_{n=1}^C \sum_{\lvec}
		(B_{\lvec}^{(n)})^*
		\sum_{\jvec \in L}
		\phi_{\jvec} \frac{\partial}{\partial (\alpha_{\jvec}^{(n)})^*} B_{\lvec}^{(c)}
	\right] \\
	& = \mathcal{P} \left[
		\sum_{n=1}^C \sum_{\lvec}
		(B_{\lvec}^{(n)})^*
		\frac{\delta}{\delta \Psi_n^*}
		B_{\lvec}^{(c)}
	\right]
\end{split}
\end{equation*}
\end{proof}

\todo{Fix those awful variable clashes!}
\todo{This means that Stratonovich term is equal to zero for our $B \equiv B(\Psivec)$.}

