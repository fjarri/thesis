% =============================================================================
\section{Minimal lattice}
% =============================================================================

This chapter shows how to calculate minimal lattice which contains all modes below given cutoff $\ecut$.


% =============================================================================
\subsection{Uniform grid}
% =============================================================================

In case of 1D uniform grid, the cutoff condition looks like:
\[
	\frac{\hbar^2 k^2}{2 m} \le \ecut,
\]
\[
	k \le \sqrt{\frac{2 m \ecut}{\hbar^2}} = k_{\mathrm{cut}}.
\]
In FFT algorithm, maximum spatial frequency for given problem size $N$ and lattice step $d$ can be found as:
\[
	k_{\max} = 2 \pi \frac{ \left[ \frac{N}{2} \right] }{N d}.
\]
If $L = d (N - 1)$ is fixed, the condition for even $N$ is easier to find first:
\[
	N_{\min,\mathrm{even}} = 2 \lceil
		\frac{k_{\mathrm{cut}} L}{2 \pi} + \frac{1}{2}
	\rceil.
\]
Then, one should check whether $k_{\max}$ corresponding to $N_{\min,\mathrm{even}} - 1$ is still larger than $k_{\mathrm{cut}}$; if it is, it should be used as minimal lattice size instead.
In 3D case, $N_{\min}$ can be calculated separately for each dimension using corresponding values of $L$.


% =============================================================================
\subsection{Harmonic grid}
% =============================================================================

In 1D case, the cutoff condition is:
\[
	\hbar \omega ( n + \frac{1}{2} ) \le \ecut,
\]
where $\omega$ is the trap frequency.
Therefore minimal lattice size can be found as:
\[
	N_{\min} = \lceil \frac{\ecut}{\hbar \omega} - \frac{1}{2} \rceil.
\]
3D case is a bit more complicated:
\[
	\hbar \left(
		\omega_x (n_x + \frac{1}{2})
		+ \omega_y (n_y + \frac{1}{2})
		+ \omega_z (n_z + \frac{1}{2})
	\right) \le \ecut,
\]
and minimal lattice sizes are:
\begin{equation*}
\begin{split}
	N_{x,\min} & = \lceil
		\frac{\ecut / \hbar - \omega_y / 2 - \omega_z / 2}{\omega_x} - \frac{1}{2}
	\rceil, \\
	N_{y,\min} & = \lceil
		\frac{\ecut / \hbar - \omega_x / 2 - \omega_z / 2}{\omega_y} - \frac{1}{2}
	\rceil, \\
	N_{z,\min} & = \lceil
		\frac{\ecut / \hbar - \omega_x / 2 - \omega_y / 2}{\omega_z} - \frac{1}{2}
	\rceil.
\end{split}
\end{equation*}
