% =============================================================================
\section{Split-step propagation}
% =============================================================================


% =============================================================================
\subsection{General form}
% =============================================================================

Split-step propagation method~\citationneeded is used to obtain the numerical solution of the following differential equation:
\begin{equation}
\label{eqn:split-step:general-eqn}
	\frac{d\Psi(\xvec, t)}{dt} = \left(
		\hat{D}(\nabla) + \hat{N}(\xvec, t)
	\right) \Psi(\xvec, t)
\end{equation}
given the initial state $\psi(\xvec, 0)$,
where $\hat{D}$ is the differential operator, and $\hat{N}$ is the nonlinear operator,
which is just a common function.

The equation~\eqnref{split-step:general-eqn} can be rewritten as:
\[
	\Psi(\xvec, t + dt) \simeq \exp ( ( \hat{D} + \hat{N} ) dt ) \Psi(\xvec, dt).
\]
The idea of split-step Fourier method is to separate the calculation of both terms:
\begin{equation}
\label{eqn:split-step:split-eqn}
	\Psi(\xvec, t + dt) \simeq \exp(dt \hat{D}) \exp(dt \hat{N}) \Psi(\xvec, t)
\end{equation}
and calculate the differential factor in Fourier domain, where spatial derivative can be replaced by simple multiplication:
\[
	\Psi(\xvec, t + dt) \simeq \left\{
		\hat{F}^{-1} \exp \left[
			d\tau \hat{D}(i k)
		\right] \hat{F}
	\right\}
	\exp(dt \hat{N}) \Psi(\xvec, t).
\]
Here $\hat{D}(i k)$ is obtained by replacing differential operator by $i k$,
where $k$ is a spatial frequency in Fourier domain.
The equation is approximate, because splitting operators in this way ignores the fact that they do not commute.

In order to improve the accuracy of the method, equation~\eqnref{split-step:split-eqn} can be rewritten as~\cite{Sinkin2003}
\[
	\Psi(\xvec, t + dt) \simeq
	\exp \left( \frac{dt}{2} \hat{D} \right)
	\exp \left( \int\limits^{t + dt}_t \hat{N} (t^\prime) dt^\prime \right)
	\exp \left( \frac{dt}{2} \hat{D} \right) \Psi(\xvec, t).
\]
This method is called the symmetrized split-step Fourier method, and it has the global error of $\mbox{O}(dt^2)$.
Integral can be evaluated either by approximating it with $dt \hat{N}(t)$ or by using slightly more accurate method,
like trapezoidal rule
\[
	\int\limits^{t + dt}_t \hat{N} (t^\prime) dt^\prime \simeq
	\frac{dt}{2} \left( \hat{N}(t) + \hat{N}(t + dt) \right).
\]
Since the value of $\hat{N}(t + dt)$ is unknown at the time of the calculation
(it is performed in the middle of the step), an iterative procedure is necessary.


% =============================================================================
\subsection{Two-component form}
% =============================================================================

The case of two-component cGPEs with coupling terms (like~\eqnref{mean-field:cgpes_simplified})
has to be described in detail.
We have the following system of equations:
\begin{equation}
\label{eqn:split-step:two-comp-eqn}
	\frac{d \Psivec}{dt} = \hat{D} \Psivec + \hat{N} \Psivec,
\end{equation}
where $\Psivec$ is a vector of two functions $(\Psi_1, \Psi_2)$,
$\hat{D}$ is a differential operator:
\[
	\hat{D} = \begin{pmatrix}
		\frac{i \hbar}{2 m} \nabla^2 & 0 \\
		0 & \frac{i \hbar}{2 m} \nabla^2
	\end{pmatrix},
\]
and $\hat{N}$ is a nonlinear operator:
\[
	\hat{N} = \begin{pmatrix}
		-\frac{i}{\hbar} \left( V + g_{11} n_1 + g_{12} n_2 \right) - \Gamma_1 &
		-i \frac{\Omega}{2} e^{-i (\delta t + \alpha)} \\
		-i \frac{\Omega}{2} e^{i (\delta t + \alpha)} &
		-\frac{i}{\hbar} \left( V + g_{12} n_1 + g_{22} n_2 \right) - \Gamma_2
	\end{pmatrix}
	= \begin{pmatrix}
		N_1 & -i \frac{\Omega}{2} e^{-i \phi} \\ - i \frac{\Omega}{2} e^{i \phi} & N_2
	\end{pmatrix}
\]

In order to integrate equation~\eqnref{split-step:two-comp-eqn},
we have to calculate the matrix exponent $\exp \hat{N}$.
Eigenvalues:
\begin{equation*}
\begin{split}
	\lambda_1 & = \frac{1}{2} \left(
		N_1 + N_2 - \sqrt{(N_1 - N_2)^2 - \Omega^2}
	\right), \\
	\lambda_2 & = \frac{1}{2} \left(
		N_1 + N_2 + \sqrt{(N_1 - N_2)^2 - \Omega^2}
	\right). \\
\end{split}
\end{equation*}
Eigenvectors:
\begin{equation*}
\begin{split}
	v_1 = \begin{pmatrix}
		1 \\
		-\frac{i e^{i \phi}}{\Omega} \left(
			\sqrt{(N_1 - N_2)^2 - \Omega^2} + N_1 - N_2
		\right)
	\end{pmatrix}
	= \begin{pmatrix}
		1 \\ a_1
	\end{pmatrix}, \\
	v_2 = \begin{pmatrix}
		1 \\
		\frac{i e^{i \phi}}{\Omega} \left(
			\sqrt{(N_1 - N_2)^2 - \Omega^2} - N_1 + N_2
		\right)
	\end{pmatrix}
	= \begin{pmatrix}
		1 \\ a_2
	\end{pmatrix}.
\end{split}
\end{equation*}
Thus
\begin{equation}
\begin{split}
	\exp \hat{N} & = \begin{pmatrix}
		1 & 1 \\ a_1 & a_2
	\end{pmatrix}
	\begin{pmatrix}
		e^{\lambda_1} & 0 \\ 0 & e^{\lambda_2}
	\end{pmatrix}
	\begin{pmatrix}
		1 & 1 \\ a_1 & a_2
	\end{pmatrix}^{-1} \\
	& = \frac{1}{a_1 - a_2}
	\begin{pmatrix}
		1 & 1 \\ a_1 & a_2
	\end{pmatrix}
	\begin{pmatrix}
		e^{\lambda_1} & 0 \\ 0 & e^{\lambda_2}
	\end{pmatrix}
	\begin{pmatrix}
		-a_2 & 1 \\ a_1 & -1
	\end{pmatrix} \\
	& = \frac{1}{a_1 - a_2}
	\begin{pmatrix}
		e^{\lambda_2} a_1 - e^{\lambda_1} a_2 &
		e^{\lambda_1} - e^{\lambda_2} \\
		a_1 a_2 (e^{\lambda_2} - e^{\lambda_1}) &
		e^{\lambda_1} a_1 - e^{\lambda_2} a_2.
	\end{pmatrix}
\end{split}
\end{equation}
This formula now can be used in split-step integration~\eqnref{split-step:split-eqn}.
