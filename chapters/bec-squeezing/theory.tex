% =============================================================================
\section{Spin squeezing in the Wigner representation}
\label{sec:bec-squeezing:theory}
% =============================================================================

Following S{\o}rensen \textit{et~al}~\cite{Sorensen2001} and Li \textit{et~al}~\cite{Li2009}, we define the components of the collective spin vector $\hat{\mathbf{S}} \equiv (\hat{S}_x, \hat{S}_y, \hat{S}_z)$ in terms of field operators as
\begin{eqn}
	\hat{S}_x
	& = \frac{1}{2} \int \upd \xvec \left(
			\Psiop_2^\dagger \Psiop_1 + \Psiop_1^\dagger \Psiop_2
		\right), \\
	\hat{S}_y
	& = \frac{i}{2} \int \upd \xvec \left(
			\Psiop_2^\dagger \Psiop_1 - \Psiop_1^\dagger \Psiop_2
		\right), \\
	\hat{S}_z
	& = \frac{1}{2} \int \upd \xvec \left(
			\Psiop_1^\dagger \Psiop_1 - \Psiop_2^\dagger \Psiop_2
		\right).
\end{eqn}
The degree of squeezing is then
\begin{eqn}
\label{eqn:bec-squeezing:theory:xi2}
    \xi^2
    = \frac{N \min_{\vec{n} \perp \hat{\langle \mathbf{S} \rangle}} \Delta \hat{S}^2_{\vec{n}}}%
    	{\langle \hat{\mathbf{S}} \rangle^2},
\end{eqn}
where $\Delta \hat{S}^2_{\vec{n}}$ is the variance of the total spin along the direction $\vec{n}$, and $N$ is the total number of atoms.
This quantity can serve as an entanglement criterion, indicating its occurrence when $\xi^2 < 1$~\cite{Sorensen2001}.
Note that in this thesis we only consider the squeezing along the direction orthogonal to the total spin, as was originally introduced, but other definitions are also possible~\cite{He2011}.

A straightforward way of finding the $\xi^2$ is to shift the coordinate frame to the end of the vector $\langle \hat{\mathbf{S}} \rangle$, and rotate it so that one of the axes is aligned along it.
The minimum variance can then be found by varying the angle of rotation of the other two axes and calculating the variance along one of them (in fact, this is how it is usually done in the experiment).
The direct approach consists of expressing the desirable minimum variance in terms of variances of the components of the spin vector in the original coordinates~\cite{Li2009}.
We denote the polar and the azimuthal angle of $\langle \hat{\mathbf{S}} \rangle$ as $\nu$ and $\phi$ respectively, meaning that
\begin{eqn}
	\nu = \arccos \frac{\langle \hat{S}_z \rangle}{\langle \hat{\mathbf{S}} \rangle},\quad
	\phi = \arg \langle \hat{S}_x + \hat{S}_z \rangle.
\end{eqn}
The minimum uncertainty is then expressed as
\begin{eqn}
	\min_{\vec{n} \perp \langle \hat{\mathbf{S}} \rangle} \Delta \hat{S}^2_{\vec{n}}
	={} & \frac{1}{2} \left(
			\cos^2 \nu \cos^2 \phi + \sin^2 \phi
		\right) \Delta_{xx}
		+ \frac{1}{2} \left(
			\cos^2 \nu \sin^2 \phi + \cos^2 \phi
		\right) \Delta_{yy} \\
		& + \frac{1}{2} \sin^2 \nu\, \Delta_{zz}
			- \frac{1}{2} \sin^2 \nu \sin2\phi\, \Delta_{xy}
			- \frac{1}{2} \sin2\nu \cos \phi\, \Delta_{xz} \\
		& - \frac{1}{2} \sin2\nu \sin \phi\, \Delta_{yz}
		- \frac{1}{2} \sqrt{\tilde{A}^2 + \tilde{B}^2},
\end{eqn}
where
\begin{eqn}
	\tilde{A}
	={} & \left( \sin^2 \phi - \cos^2 \nu \cos^2 \phi \right) \Delta_{xx}
			+ \left( \cos^2 \phi - \cos^2 \nu \sin^2 \phi \right) \Delta_{yy} \\
		& - \sin^2 \nu\, \Delta_{zz}
			- \left( 1 + \cos^2 \nu \right) \sin2\phi\, \Delta_{xy} \\
		& + \sin2\nu \cos \phi\, \Delta_{xz}
			+ \sin2\nu \sin\phi\, \Delta_{yz},
\end{eqn}
and
\begin{eqn}
	\tilde{B}
	={} & \cos\nu \sin2\phi \left( \Delta_{xx} - \Delta_{yy} \right)
			- 2 \cos\nu \cos2\phi\, \Delta_{xy} \\
		& - 2 \sin\nu \sin\phi\, \Delta_{xz}
			+ 2 \sin\nu \cos\phi\, \Delta_{yz}.
\end{eqn}
The spin correlations $\Delta_{ij}$ are defined as
\begin{eqn}
	\Delta_{ij}
	= \frac{1}{2} \langle \hat{S}_i \hat{S}_j + \hat{S}_j \hat{S}_i \rangle
		- \langle \hat{S}_i \rangle \langle \hat{S}_j \rangle,\quad
		i,j=x,y,z.
\end{eqn}

Averages of the total spin vector components and their pairwise moments can be expressed calculated using moments of the Wigner functional according to~\eqnref{wigner-bec:fpe-bec:moments}.
The averages are calculated straightforwardly if we remember that the field operators of different components commute:
\begin{eqn}
	\langle \hat{S}_x \rangle
		& = \pathavg{\Real \int \Psi^*_1 \Psi_2 \upd\xvec }
		\equiv \pathavg{\Real I}
		\equiv \pathavg{S_x}, \\
	\langle \hat{S}_y \rangle
		& = \pathavg{\Imag \int \Psi^*_1 \Psi_2 \upd\xvec }
		\equiv \pathavg{\Imag I}
		\equiv \pathavg{S_y}, \\
	\langle \hat{S}_z \rangle
		& = \frac{1}{2} \pathavg{\int \Psi^*_1 \Psi_1 \upd\xvec - \int \Psi^*_2 \Psi_2 \upd\xvec}
		\equiv \pathavg{(N_1 - N_2) / 2}
		\equiv \pathavg{S_z},
\end{eqn}
where we have introduced the functionals of wavefunctions in a single simulation path $I \equiv S_x + i S_y$ and $(N_1 - N_2) / 2 \equiv S_z$.

The second-order moments of the spin operators are obtained by transforming normally ordered field operator products to symmetrically ordered ones, substituting path averages of wavefunction moments and grouping terms.
Starting with $\langle \hat{S}^2_x \rangle$, we can express it in terms of symmetrically ordered operator products as
\begin{eqn}
	\langle \hat{S}^2_x \rangle
	={} & \frac{1}{4} \left\langle \int
		\left(
			\Psiop^\dagger_2 \Psiop_1 + \Psiop^\dagger_1 \Psiop_2
		\right)
		\left(
			\Psiop^{\prime\dagger}_2 \Psiop^\prime_1 + \Psiop^{\prime\dagger}_1 \Psiop^\prime_2
		\right)
		\upd\xvec\, \upd\xvec^\prime \right\rangle \\
	={} & \frac{1}{4} \left\langle \int \left(
			\symprod{ \Psiop^\dagger_2 \Psiop_1 \Psiop^{\prime\dagger}_2 \Psiop^\prime_1 }
			+ \symprod{ \Psiop^\dagger_1 \Psiop_2 \Psiop^{\prime\dagger}_2 \Psiop^\prime_1 }
		\right. \right. \\
		& \left. \left.
			+ \symprod{ \Psiop^\dagger_1 \Psiop_2 \Psiop^{\prime\dagger}_1 \Psiop^\prime_2 }
			+ \symprod{ \Psiop^\dagger_2 \Psiop_1 \Psiop^{\prime\dagger}_1 \Psiop^\prime_2 }
		\right. \right. \\
	& \left. \left.
		- \frac{1}{2} \Real \left(
			\delta_{\restbasis_1} (\xvec, \xvec^\prime)
			\delta_{\restbasis_2} (\xvec^\prime, \xvec)
		\right)
	\right) \upd\xvec\, \upd\xvec^\prime \right\rangle.
\end{eqn}
In general, basis sets of the first and the second component are different, and the last term in the above equation cannot be simplified any further.
However, in the numerical simulations in this chapter we use the same set $\restbasis_1 = \restbasis_2 = \restbasis$ for both components, which allows us to transform it to a more convenient form
\begin{eqn}
	\int \Real \left(
			\delta_{\restbasis} (\xvec, \xvec^\prime)
			\delta_{\restbasis} (\xvec^\prime, \xvec)
		\right) \upd\xvec\, \upd\xvec^\prime
	& = \frac{1}{2} \int \left(
			\sum_{\mvec \in \restbasis} \phi_{\mvec}^\prime \phi_{\mvec}^*
			\sum_{\nvec \in \restbasis} \phi_{\nvec} \phi_{\nvec}^{\prime*}
			+ \mathrm{c.\,c.}
		\right) \upd\xvec\, \upd\xvec^\prime \\
	& = \frac{1}{2} \sum_{\mvec \in \restbasis} \sum_{\nvec \in \restbasis}
		\left(
			\delta_{\mvec,\nvec} \delta_{\mvec,\nvec}
			+ \delta_{\mvec,\nvec} \delta_{\mvec,\nvec}
		\right) \\
	& = | \restbasis |,
\end{eqn}
where we have expanded the restricted delta functions using the expression from \defref{func-calculus:restricted-delta}.
Applying~\eqnref{wigner-bec:fpe-bec:moments} to the full expression for $\langle \hat{S}^2_x \rangle$, we rewrite it in terms of wavefunctions in the Wigner representation:
\begin{eqn}
	\langle \hat{S}^2_x \rangle
	& = \frac{1}{4} \pathavgleft
		\int \Psi^*_2 \Psi_1 \upd\xvec \int \Psi^*_2 \Psi_1 \upd\xvec
		+ \int \Psi^*_1 \Psi_2 \upd\xvec \int \Psi^*_2 \Psi_1 \upd\xvec \right. \\
	&	\left. + \int \Psi^*_1 \Psi_2 \upd\xvec \int \Psi^*_1 \Psi_2 \upd\xvec
		+ \int \Psi^*_2 \Psi_1 \upd\xvec \int \Psi^*_1 \Psi_2 \upd\xvec
		- \frac{|\restbasis|}{2} \pathavgright \\
	& = \frac{1}{4} \pathavg{ (I^*)^2 + I I^* + I^2 + I^* I } - \frac{|\restbasis|}{8} \\
	& = \pathavg{ (\Real I)^2 } - \frac{|\restbasis|}{8}
	= \pathavg{ S^2_x } - \frac{|\restbasis|}{8}.
\end{eqn}

Using the same procedure, we find the expectations for other pairwise moments of the spin operators:
\begin{eqn}
\label{eqn:bec-squeezing:thoery:spin-squares}
	\langle \hat{S}^2_y \rangle
	& = \pathavg{ S^2_y } - \frac{|\restbasis|}{8}, \\
	\langle \hat{S}^2_z \rangle
	& = \pathavg{ S^2_z } - \frac{|\restbasis|}{8}, \\
	\frac{1}{2} \langle \hat{S}_x \hat{S}_y + \hat{S}_y \hat{S}_x \rangle
	& = \pathavg{ S_x S_y }, \\
	\frac{1}{2} \langle \hat{S}_x \hat{S}_z + \hat{S}_z \hat{S}_x \rangle
	& = \pathavg{ S_x S_z }, \\
	\frac{1}{2} \langle \hat{S}_y \hat{S}_z + \hat{S}_z \hat{S}_y \rangle
	& = \pathavg{ S_y S_z }.
\end{eqn}

Now we have all the required expectations to calculate the spin correlations $\Delta_{ij}$ and, consequently, the degree of squeezing $\xi^2$.
Note that if we neglect the term $|\restbasis|/8$ in the equations for $\langle \hat{S}_i^2 \rangle$ (which is small as compared to $S_i^2$ when the Wigner truncation condition~\eqnref{wigner-bec:truncation:delta-condition} applies), the spin correlations behave ``classically''.
This means that they behave as if we had a ``cloud'' of spin vectors, where each vector corresponds to a separate simulation path, and the correlations are classical correlations of different vector components in this cloud.
Consequently, without giving up too much accuracy we can informally illustrate the total spin uncertainty by plotting the distribution of the total spin vector $(S_x, S_y, S_z)$ over the integration trajectories.
