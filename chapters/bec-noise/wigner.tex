% =============================================================================
\section{Wigner transformation}
% =============================================================================


\copypaste{
We start by assuming that the BEC has $s$-wave interactions, together with Markovian losses due to $n$-body collisions.
We employ a master equation together with the Wigner-Moyal quantum phase-space representation~\cite{Gardiner2004} and a truncation of third- and higher-order derivatives in the equations of motion.
If we regard the commonly used Gross-Pitaevskii equation as a classical, first approximation to mean-field condensate dynamics, the truncated Wigner approach is best thought of as the second term in an expansion in inverse particle number.
}

\todo{
This section should be mostly dedicated to results in \cite{Egorov2011} and \cite{Opanchuk2012} (and possibly \cite{Egorov2013}).
}


In the present Letter, we treat an ultra-cold,
interacting multi-component spinor Bose gas in $D$ effective dimensions.
The basic Hamiltonian is easily expressed using quantum fields
$\Psiop_j^{\dagger}(\xvec)$ and $\Psiop_j(\xvec)$,
where $\Psiop_j^{\dagger}(\xvec)$ creates a bosonic atom of spin $j$
at location $\xvec$, and $\Psiop_j(\xvec)$ destroys one;
the commutators are
$[\Psiop_j(\xvec),\Psiop_k^{\dagger}(\xvec^\prime)] =
\delta^{(D)}(\xvec-\xvec^\prime)\delta_{jk}.$
The resulting physics of a dilute, low-temperature Bose gas
is well-described in the $s$-wave scattering limit by an effective Hamiltonian
with contact interactions and external potentials:
\begin{equation}
    \hat{H} / \hbar = \int \upd^{D}\xvec \left\{
        \Psiop_j^{\dagger} K_{jk} \Psiop_k +
        \frac{U_{jk}}{2} \Psiop_j^{\dagger} \Psiop_k^{\dagger}
        \Psiop_k \Psiop_j
    \right\}.
\end{equation}
Here we omit the field argument $(\xvec)$ for brevity,
and use the Einstein summation convention of summing over repeated indices.
$K_{jk}$ is the single-particle Hamiltonian:
\begin{equation}
    K_{jk} = \left( -\frac{\hbar}{2m} \nabla^2 + \omega_j + V_j(\xvec) / \hbar \right) \delta_{jk} +
        \tilde{\Omega}_{jk}(t),
\end{equation}
where $m$ is the atomic mass, $V_j$ is the external trapping potential for spin $j$,
$\omega_j$ is the internal energy of spin $j$,
$\tilde{\Omega}_{jk}$ represents a time-dependent coupling
that is used to rotate one spin projection into another,
and $U_{jk}$ is the atom-atom interaction term.
Thus, $n_j = \langle \Psiop_j^{\dagger} \Psiop_j \rangle$
is the spin-$j$ atomic density.
For a dilute gas at low enough temperatures,
$U_{jk}=4\pi\hbar a_{jk} / m$, where $a_{jk}$ is the $s$-wave scattering length in three dimensions.
Here we assume a momentum cutoff $k_{c} \ll 1 / a_{jk}$,
otherwise the couplings must be renormalized~\cite{Sinatra2002}.

We proceed by using a stochastic phase-space method that allows a numerical
simulation of the quantum dynamics~\cite{Drummond1993,Steel1998,Hoffmann2008}.
Defining a Wigner function $W(\Psivec)$, where $\Psi_j$
is a c-number field corresponding to the quantum field $\hat{\Psi}_j$, this has a unitary time-evolution equation:
\begin{equation}
    \frac{\partial W}{\partial t} = \int \upd^D\xvec \left\{
        - \frac{\delta}{\delta\Psi_j} A_j
        - \frac{\delta}{\delta\Psi_j^*}A_j^*
        + \mbox{O} \left[ \frac{\delta^3}{\delta\Psi_j^3} \right]
    \right\} W.
\end{equation}
Next, higher-derivative terms of type $\mbox{O} \left[ \delta^3 / \delta\Psi_j^3 \right]$ are truncated.
This approximation neglects higher-order terms in an expansion in $1 / \sqrt{N}$,
and is therefore valid in the limit of $N \gg M$
where $N$ is the atom number and $M$ is the number of low-energy modes included~\cite{Drummond1993,Sinatra2002,Norrie2006}.
In free-space calculations it is important to maintain this mode truncation.
In the relevant limits where the technique is applicable, the equations
simply reduce to Gross-Pitaevskii equations with Gaussian fluctuations
of the initial conditions:
\begin{equation}
\label{eqn:SDE-1}
    \frac{\upd\Psi_j}{\upd t} = -i \left(
        K_{jk} \Psi_k + U_{jk} \lvert \Psi_k \rvert^2 \Psi_j
    \right).
\end{equation}
For initial conditions in interferometry it is usually sufficient to consider
a coherent state amplitude $\Psi_s^c$,
corresponding to a typical initial state with Poissonian number fluctuations,
as produced by a beam-splitter.
In this case the initial Wigner amplitude has a Gaussian random distribution, with
$\Psi_j(\xvec, t_0) = \Psi_j^c(\xvec) + \Delta \Psi_j(\xvec)$, where:
$\left\langle \Delta \Psi_j(\xvec) \Delta \Psi_k^*(\xvec^{\prime}) \right\rangle =
\delta_{jk} \delta^D(\xvec - \xvec^{\prime}) / 2.$
This initial noise is necessary because the Wigner representation generates
symmetrically ordered correlation functions, and includes vacuum fluctuations.
For greater accuracy, the initial state can be modified to account for
initial  correlations, thermal noise, or additional fluctuations.
If normal ordered correlations are measured, one has to express them
as a sum of symmetrically ordered terms.

This includes all the known nonlinear quantum noise effects of quantum dynamics,
like phase diffusion, entanglement and quantum squeezing, in the limit
of large particle number.
The initial noise terms do not occur in the semi-classical Gross-Pitaevskii
approximation, which is therefore unable to predict these effects.
Thus, while the lossless equations are identical to the Gross-Pitaevskii
equations, the inclusion of initial noise terms together with nonlinear
interactions leads to quantum phase-diffusion.
Such methods can be used for either free-space or trapped atom interferometry,
provided there is an appropriate mode truncation.

Additional quantum noise enters from the effects of damping and losses,
due to the fluctuation-dissipation theorem.
These effects are important at high densities in atomic traps.
They can be included via an additional Markovian master equation~\cite{Jack2002}
defined so that,
\begin{equation}
    \frac{\upd\hat{\rho}}{\upd t} =
        - \frac{i}{\hbar} \left[ \hat{H}, \hat{\rho} \right]
        + \sum_{n,\lvec} \kappa_{\lvec}^{(n)} \int \upd^{D}\xvec
            \mathcal{L}_{\lvec}^{(n)} \left[ \hat{\rho} \right],
\end{equation}
where $n$ is the number of interacting particles,
$\lvec = (l_1, l_2, \ldots, l_n)$ is a vector indicating the spins that are coupled,
and we have introduced local Liouville loss terms,
\begin{equation}
    \mathcal{L}_{\lvec}^{(n)} \left[ \hat{\rho} \right] =
        2\hat{O}_{\lvec}^{(n)} \hat{\rho} \hat{O}_{\lvec}^{(n)\dagger}
        - \hat{O}_{\lvec}^{(n)\dagger} \hat{O}_{\lvec}^{(n)} \hat{\rho}
        - \hat{\rho} \hat{O}_{\lvec}^{(n)\dagger} \hat{O}_{\lvec}^{(n)}.
\end{equation}
The reservoir coupling operators $\hat{O}_{\lvec}^{(n)}$ are the distinct $n$-fold products of local field annihilation operators,
$\hat{O}_{\lvec}^{(n)} = \hat{O}_{\lvec}^{(n)} (\widehat{\Psivec}) =
    \Psiop_{l_{1}} (\xvec)
    \Psiop_{l_{2}} (\xvec) \ldots
    \Psiop_{l_{n}} (\xvec),$
describing local $n$-body collision losses.

After transforming these new terms to evolution equations for the Wigner distribution, the drift term $A_j$
changes the Gross-Pitaevskii evolution to include nonlinear damping, while
the next terms in the evolution equation give rise to additional Fokker-Planck
diffusion terms associated with quantum noise from the loss reservoirs,
given by:
\begin{equation}
    \frac{\delta^{2}}{\delta\Psi_j\delta\Psi_k^{*}} \left\{
        \sum_{n,\lvec} \kappa_{\lvec}^{(n)}
            \frac{\partial O_{\lvec}^{(n)*}}{\partial\Psi_j^{*}}
            \frac{\partial O_{\lvec}^{(n)}}{\partial\Psi_k}
        \right\} W.
\end{equation}

This leads to a stochastic equation:
\begin{equation}
\label{eqn:SDE}
    \frac{\upd\Psi_j}{\upd t} =
        - i\left( K_{jk} \Psi_k + U_{jk} \lvert \Psi_k \rvert^{2} \Psi_j \right)
        - \Gamma_j
        + \sum_{n,\lvec} \beta_{\lvec,j}^{(n)} \zeta_{\lvec}^{(n)}(\xvec,t),
\end{equation}
where the nonlinear loss has the form:
\begin{equation}
    \Gamma_j = \sum_{n,\lvec}
        \kappa_{\lvec}^{(n)}
        \frac{\partial O_{\lvec}^{(n)*} (\Psivec)}{\partial\Psi_j^{*} (\xvec)}
        O_{\lvec}^{(n)}(\xvec),
\end{equation}
and $\zeta_{\lvec}^{(n)}(\xvec, t)$ is a corresponding complex,
stochastic delta-correlated Gaussian noise with
\begin{equation}
    \left\langle
        \zeta_{\lvec}^{(n)} (\xvec,t) \zeta_{\kvec}^{(m)*}(\xvec^\prime, t^\prime)
    \right\rangle =
    \delta_{\lvec \kvec} \delta^{nm} \delta^{D} \left(
        \xvec - \xvec^\prime
    \right)
    \delta \left( t - t^\prime \right).
\end{equation}
The multiplicative noise coefficient
\begin{equation}
    \beta_{\lvec,j}^{(n)} \left( \Psivec \right) =
    \sqrt{\kappa_{\lvec}^{(n)}}
    \frac{\partial O_{\lvec}^{(n)}}{\partial\Psi_j}
\end{equation}
is a fluctuation-dissipation term,
so that the Wigner variables remain equivalent to the corresponding operators.

The loss coefficients in eq.~(\ref{eqn:SDE}) can be converted to the conventional form,
which is defined using atom number losses:
\begin{equation}
    \dot{n}_j = - \gamma^{(n)}_{\lvec,j} n^{m_1}_1 n^{m_2}_2 \ldots ,
\end{equation}
where $n_j$ is the density of component $j$ and $m_j$
is the number of spin-$j$ atoms lost in the collision.
The conversion can be carried out as $\gamma^{(n)}_{\lvec,j} = 2 m_j \kappa^{(n)}_{\lvec}$.

In this work we use a basis of plane waves in the volume $V$,
and the density of component $j$ is calculated as a probabilistic average:
\begin{equation}
\label{eqn:wigner-density}
    n_j (\xvec)
        = \langle \Psi^*_j (\xvec) \Psi_j (\xvec) \rangle_{\mathrm{paths}} - \frac{M}{2V}.
\end{equation}
Here we use the fact that the approximate Wigner function is a probability distribution
equivalent to an averaged sum over different simulation paths.

\begin{figure}
    %\begin{tabular}{l l}
    %\imagetop{\hspace*{0.44in}\includegraphics[width=0.72\columnwidth]{ramsey_sequence.eps}} & \imagetop{(a)} \\
    %\imagetop{\includegraphics[width=0.85\columnwidth]{long_ramsey_visibility.eps}} & \imagetop{(b)} \\
    %\imagetop{\hspace*{0.44in}\includegraphics[width=0.72\columnwidth]{echo_sequence.eps}} & \imagetop{(c)} \\
    %\imagetop{\includegraphics[width=0.85\columnwidth]{long_rephasing_visibility.eps}} & \imagetop{(d)}
    %\end{tabular}

    \caption{
    Timeline of the experiment for Ramsey (a) and Ramsey with spin echo (c); (b) and (d) are the simulated plots of interferometric visibility.
    Classical GPE (red dashed lines) and Wigner calculations (blue solid lines) are shown.
    $N = 5.5 \times 10^4$,
    $\omega_x = \omega_y = 2 \pi \times 97.0\un{Hz}$,
    $\omega_z = 2 \pi \times 11.69\un{Hz}$,
    $a_{11} = 100.4\,a_0$, $a_{12} = 97.993\,a_0$, $a_{22} = 95.57\,a_0$~\cite{Egorov2011},
    $a_0$ is the Bohr radius.
    Nonlinear atomic losses:
    $\gamma^{(3)}_{111} = 5.4 \times 10^{-30}\un{cm^6/s}$~\cite{Mertes2007},
    $\gamma^{(2)}_{12} = 1.51 \times 10^{-14}\un{cm^3/s}$,
    $\gamma^{(2)}_{22} = 8.1 \times 10^{-14}\un{cm^3/s}$~\cite{Egorov2011}.}

    \label{fig:visibility}
\end{figure}

To illustrate the applications of this method we consider recent interferometry
experiments with a two-component BEC involving two hyperfine states
${\ket{F=1,\, m_F=-1}}$ and ${\ket{F=2,\, m_F=+1}}$ in \Rb~\cite{Egorov2011}.
A conventional Ramsey sequence (\figref{visibility},~(a)) has been used
with a BEC confined in a cigar-shaped magnetic trap with the frequencies $(97.0, 97.0, 11.69)\un{Hz}$
in a bias magnetic field of $3.23\un{G}$, so that magnetic field dephasing is largely eliminated~\cite{Hall1998}.
The first $\pi/2$ pulse prepares a non-equilibrium superposition of states ${\ket{1,-1}}$ and ${\ket{2,+1}}$
and the spatial modes of two components periodically separate and merge again~\cite{Mertes2007}.
The spatially-separated spin components evolve differently, as they have
different scattering lengths.
As a result, these collective oscillations lead to periodic dephasing and
self-rephasing of the BEC components, clearly visible in both GPE and Wigner
simulations of interference fringe visibility
$\mathcal{V}$ (\figref{visibility},~(b)).
Asymmetric losses of two states are one cause of the contrast decay.
This can be partially compensated by the application of a spin echo pulse
mid-way through the evolution (\figref{visibility},~(c)).
The GPE simulations wrongly predict (dashed lines) that visibility is largely
recovered at long evolution times using the spin echo method.
However, the addition of quantum noise (solid line) via the Wigner simulations
noticeably speeds up the visibility decay even with a spin echo pulse present.
This is in agreement with experimental observations, and shows that these
effects play a significant part in the decay of visibility, even for
large particle numbers.

The important feature of these quantum dynamical simulations
is that they are able to treat large numbers of atoms (55,000 in this case),
while correctly tracking all the quantum noise sources, and also extending the simulations to long time-scales.
Both of these features, large atom numbers and long time-scales,
are essential ingredients to accurate interferometric measurements.
The simulations give accurate predictions despite large, multi-mode dynamical motion in three dimensions
and substantial losses of most of the condensate atoms~\cite{Egorov2011}.
On longer time-scales, the experimental accuracy is limited by technical noises, and we have no data for comparisons.

