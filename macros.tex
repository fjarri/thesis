% Some magic necessary to use small caps letters in all references to stuff from Appendices

\makeatletter

% Equation labels in small caps
\let\old@tagform@=\tagform@
\renewcommand{\tagform@}[1]{\old@tagform@{\scshape#1}}

% This command is used to make theorem number upright in theorem heading.
\renewcommand{\@upn}[1]{\textsc{#1}}

%\renewcommand*{\chapterformat}{\textsc{\thechapter}\autodot\enskip}

% We can assign text style to these counters, because, as opposed to \thechapter,
% they are not used in labels. \thechapter is handled separately by chapter heading style
% This takes care both of section/subsection headings, and section/subsection numbers in ToC
\let\old@thesection\thesection
\renewcommand{\thesection}{\textsc{\old@thesection}}

\makeatother


\declaretheorem[name=Theorem]{theorem}
\declaretheorem[name=Lemma]{lemma}
\declaretheorem[name=Definition]{definition}


\newcommand{\balpha}{\mathbf{\alpha}}
\newcommand{\bbeta}{\mathbf{\beta}}
\newcommand{\bdelta}{\mathbf{\delta}}
\newcommand{\blambda}{\mathbf{\lambda}}
\newcommand{\bfeta}{\mathbf{\eta}}
\newcommand{\bxi}{\mathbf{\xi}}
\newcommand{\bPsi}{\mathbf{\Psi}}
\newcommand{\bLambda}{\mathbf{\Lambda}}
\newcommand{\bPhi}{\mathbf{\Phi}}
\newcommand{\bXi}{\mathbf{\Xi}}

\newcommand{\avec}{\mathbf{a}}
\newcommand{\evec}{\mathbf{e}}
\newcommand{\fvec}{\mathbf{f}}
\newcommand{\jvec}{\mathbf{j}}
\newcommand{\kvec}{\mathbf{k}}
\newcommand{\lvec}{\mathbf{l}}
\newcommand{\mvec}{\mathbf{m}}
\newcommand{\nvec}{\mathbf{n}}
\newcommand{\pvec}{\mathbf{p}}
\newcommand{\svec}{\mathbf{s}}
\newcommand{\Qvec}{\mathbf{Q}}
\newcommand{\xvec}{\mathbf{x}}
\newcommand{\yvec}{\mathbf{y}}
\newcommand{\zvec}{\mathbf{z}}
\newcommand{\Zvec}{\mathbf{Z}}

% differentiation
\newcommand{\upd}{\mathup{d}} % upright "d"
\newcommand{\upbd}{\mathbfup{d}} % bold upright "d"
\newcommand{\upp}{\mathup{\partial}} % upright partial
\newcommand{\upbp}{\mathbfup{\partial}} % bold upright partial
\newcommand{\cwd}{\upp} % Wirtinger differentiation
\newcommand{\vcwd}{\upbp} % Wirtinger differentiation cogradient
\newcommand{\fdelta}{\mathup{\delta}} % symbol used in functional differentiation and integration
\newcommand{\vfdelta}{\mathbfup{\delta}} % symbol used in functional differentiation and integration

\newcommand{\ecut}{\epsilon_{\mathrm{cut}}}
\newcommand{\Tr}{\operatorname{Tr}}
\newcommand{\Trace}[1]{\Tr \left\{ #1 \right\}}

\newcommand{\symprod}[1]{\left\{ #1 \right\}_{\mathrm{sym}}}
\newcommand{\pathavg}[1]{\langle #1 \rangle_{\mathrm{paths}}}
\newcommand{\Real}{\operatorname{Re}}
\newcommand{\Imag}{\operatorname{Im}}

\newcommand{\Psivec}{\mathbf{\Psi}}
\newcommand{\Psiopf}{\hat{\Psi}} % field operator in full basis
\newcommand{\Psiop}{\tilde{\Psi}} % restricted field operator
\newcommand{\Psiopvec}{\tilde{\mathbf{\Psi}}}

\newcommand{\fullbasis}{\mathbb{B}}
\newcommand{\restbasis}{\mathbb{M}}
% projection operator
% for XITS font it requires additional spacing because the letter is too sloped
%\newcommand{\proj}[1]{\mathcal{P}_{\,#1}}
\newcommand{\proj}[1]{\mathcal{P}_{#1}}

\newcommand{\abbrev}[1]{\textsc{#1}}

% References in small caps
\newcommand{\eqnref}[1]{(\textsc{\ref{eqn:#1}})}
\newcommand{\figref}[1]{Fig.~\textsc{\ref{fig:#1}}}
\newcommand{\secref}[1]{Section~\textsc{\ref{sec:#1}}}
\newcommand{\charef}[1]{Chapter~\textsc{\ref{cha:#1}}}
\newcommand{\appref}[1]{Appendix~\textsc{\ref{cha:appendix:#1}}}
\newcommand{\thmref}[1]{Theorem~\textsc{\ref{thm:#1}}}
\newcommand{\lmmref}[1]{Lemma~\textsc{\ref{lmm:#1}}}
\newcommand{\defref}[1]{Definition~\textsc{\ref{def:#1}}}

\NewEnviron{eqn}{\begin{align}\begin{split}\BODY\end{split}\end{align}}
\NewEnviron{eqns}{\begin{align} \BODY \end{align}}
\NewEnviron{eqn*}{\begin{equation*}\begin{split} \BODY \end{split}\end{equation*}}

% Split equation with three columns
% - use && as the second separator
% - write equal signs as ={} to get correct spacing
\NewEnviron{eqn2}{\begin{equation}\begin{alignedat}{2} \BODY \end{alignedat}\end{equation}}
\NewEnviron{eqn2*}{\begin{equation*}\begin{alignedat}{2} \BODY \end{alignedat}\end{equation*}}
